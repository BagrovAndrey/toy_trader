# toy_trader — CHECKPOINT (архитектура и статус)

## Цель проекта
Построить минимальный, но корректно спроектированный алгоритмический трейдер:
- сначала toy / backtest,
- затем расширяемый до live,
- с чётким разделением: данные → стратегия → исполнение → портфель → метрики.

Фокус — понятная причинность и расширяемость, а не максимальная доходность.

---

## Принципы (зафиксированы)

1. Signal = target position, а не buy/sell.
2. Стратегия не знает:
   - про комиссии,
   - про лаги,
   - про исполнение.
3. Execution:
   - переводит текущую позицию в целевую,
   - решает когда и как исполнять.
4. DataSource:
   - отвечает за получение и нормализацию данных,
   - возвращает данные в едином формате.
5. Источник данных можно менять без изменения стратегии.
6. Начинаем с:
   - single-asset,
   - long-only,
   - bar-level trading.
7. Контракты проектируются сразу обобщаемыми (multi-asset-ready).

---

## Структура проекта (текущее состояние)

```
src/
  toy_trader/
    core_types.py     # доменные типы и контракты
    data_sources.py   # интерфейс источников данных (каркас)
```

---

## core_types.py — зафиксированные типы

### MarketData
- Один инструмент.
- bars: pandas DataFrame
  - индекс = время
  - колонки: Open, High, Low, Close, Volume
- symbol: строка.

### Signals
- target_position: pandas Series
- значения: 0 / 1 (long-only MVP)
- интерпретация: целевая позиция во времени.

### Fill
- факт исполнения сделки.
- поля:
  - symbol
  - ts
  - price
  - qty (+buy / −sell)
  - fee

### PortfolioState
- cash
- positions: Dict[symbol, qty]
- last_prices: Dict[symbol, price]
- equity

---

## data_sources.py — текущий статус

### DataSource (ABC)
- абстрактный интерфейс:
  - get_bars() -> MarketData

### CSVDataSource
- конкретная реализация DataSource
- источник: CSV-файл на диске
- ответственность:
  - прочитать CSV,
  - нормализовать формат,
  - вернуть MarketData.

### YahooDataSource
- заглушка под API-источник
- контракт тот же (MarketData).

CSV не является промежуточным форматом системы.  
CSV — это один из возможных источников данных.

---

## Что НЕ сделано (осознанно)

- Нет реализации get_bars (только каркас).
- Нет стратегий.
- Нет execution / engine / метрик.
- Нет live-интеграций.

---

## Следующий логический шаг

Перейти к strategies.py:

- интерфейс Strategy,
- метод вида generate_signals(market_data) -> Signals,
- заглушка SMACrossStrategy,
- без реализации, только контракт и структура.

