# toy_trader — STATUS CHECKPOINT #2

## Общий контекст (для восстановления мышления)

Проект — учебно-исследовательский алгоритмический трейдер с корректной архитектурой.
Цель — не «сразу зарабатывать», а:
- понять причинно-следственную цепочку в алгоритмической торговле,
- иметь код, который не придётся переписывать при переходе:
  backtest → walk-forward → live.

Фундаментальный принцип: разделение ответственности.
Каждый модуль делает одну вещь и делает её тупо.

---

## Архитектурная схема (устоялась)

DataSource → Strategy → Signals → Execution → Fills / PortfolioState → Analysis / Viz

Engine — оркестратор, не логический модуль.

---

## Зафиксированные концепции

### MarketData
- Внутренний канонический формат данных.
- Один инструмент.
- Bars = coarse-grained временной ряд (не важно: дни, минуты, секунды).
- Источник данных (CSV, Yahoo, API биржи) полностью скрыт.

### Strategy vs Signals
- Strategy = правило / отображение MarketData → Signals.
- Signals = конкретная реализация правила во времени.
- Signal трактуется как target position, а не buy/sell.

### Execution
- Execution реализует сигналы.
- В backtest execution симулирует рынок.
- В live execution общается с брокером.
- Контракт одинаковый.

### Engine
- Engine не управляет временем.
- Engine не знает про начало/конец данных.
- Engine работает с тем MarketData, которое ему дали.
- Это не мешает walk-forward и live.

---

## Текущее состояние кода

Реализованы каркасы (без логики):

```
src/toy_trader/
  core_types.py     # MarketData, Signals, Fill, PortfolioState
  data_sources.py   # DataSource (ABC), CSVDataSource, YahooDataSource (каркасы)
  strategies.py     # Strategy (ABC), SMACrossStrategy (каркас)
  execution.py      # ExecutionModel (ABC), NextBarExecutionModel (каркас)
  engine.py         # BacktestEngine + BacktestResult
src/
  run_backtest.py   # entrypoint с подробными комментариями
```

---

## Осознанно НЕ реализовано
- Реальная загрузка данных (CSV/Yahoo).
- Реализация SMA стратегии.
- Реализация next-bar execution.
- Метрики.
- Визуализация (отложена, но спроектирована как post-processing).

---

## Следующий логический шаг

Начать наполнять модули по одному:

1. CSVDataSource.get_bars()
2. SMACrossStrategy.generate_signals()
3. NextBarExecutionModel.run()

Визуализация — после появления реальных fills.

---

## Мета

Контекст проекта живёт в коде и в этом файле.
Чат — временный рабочий инструмент.
